<!DOCTYPE html>
<html>

    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>글 작성</title>
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

        <!-- include summernote css/js -->
        <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
        <link href="https://bootswatch.com/3/slate/bootstrap.css" rel="stylesheet">
        <style>
            input, select, option {
                background-color: var(--box-bg);
                border-style: solid;
                color: var(--text);
            }
            .btn-bs5-primary {
                background-color: var(--bs-primary);
                color: var(--bs-white);
            }
            .btn-bs5-secondary {
                background-color: var(--bs-secondary);
                color: var(--bs-white);
            }
        </style>
        <link href="/static/style.css" rel="stylesheet">
    </head>

    <body>
        <div class="container-xxl" style="height: 100%;" id="main">
            <div class="row mb-2" style="height: 7em;">
                <div class="col p-lg-4 mt-3 m-lg-3 shadow box" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="margin: 0px;"><strong id="school-grade-class">학급 글쓰기</strong></h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col p-lg-4 mt-3 m-lg-3 shadow box">
                    <form action="/api/post" method="post">
                        <div class="p-3">
                            <input type="text" id="title" name="title" style="width: 100%;font-size: x-large;" placeholder="제목을 입력해주세요">
                        </div>
                        <div class="p-3">
                            <textarea id="summernote" name="content"></textarea>
                        </div>
                        <hr>
                        <div class="p-3">
                            <div style="float: right;">
                                <button class="btn btn-bs5-primary" type="submit">제출</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script src="/static/summer_note/lang/summernote-ko-KR.js"></script>


        <script>
            var token = "<%= token.token %>"
            $(document).ready(function() {
                //여기 아래 부분
                $('#summernote').summernote({
                    height: 300,                 // 에디터 높이
                    minHeight: null,             // 최소 높이
                    maxHeight: null,             // 최대 높이
                    focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
                    lang: "ko-KR",					// 한글 설정
                    placeholder: '최대 4096자까지 작성할 수 있습니다',	//placeholder 설정
                    callbacks: {	//여기 부분이 이미지를 첨부하는 부분
                        onImageUpload : function(files) {
                            uploadSummernoteImageFile(files[0],this);
                        },
                        onPaste: function (e) {
                            var clipboardData = e.originalEvent.clipboardData;
                            if (clipboardData && clipboardData.items && clipboardData.items.length) {
                                var item = clipboardData.items[0];
                                if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
                                    e.preventDefault();
                                }
                            }
                        }
                    }
                });
                function uploadSummernoteImageFile(file, editor) {
                    data = new FormData();
                    data.append("file", file);
                    $.ajax({
                        data : data,
                        type : "POST",
                        url : "/api/upload-img?token=" + token,
                        contentType : false,
                        processData : false,
                        success : function(data) {
                            $(editor).summernote('insertImage', data.url);
                        }
                    });
                }
            });

            $("form").on("submit", event => {
                if ($('#summernote').summernote('code') == "<p><br></p>" || $("#title").val() == "") {
                    event.preventDefault();
                    alert("제목과 내용을 모두 입력해주세요.")
                } 
                if ($($('#summernote').summernote('code')).text().length > 4096) {
                    event.preventDefault();
                    alert("내용은 4096자 이하만 가능합니다")
                }
            })
        </script>
        
    </body>
</html>